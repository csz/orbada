apply plugin: 'java'
apply plugin: "maven"

compileJava.options.encoding = 'ISO-8859-1'
sourceCompatibility = 1.6
targetCompatibility = 1.6


group = "orbada"
version = "1.2.4"

//jar {
//	manifest {
//		attributes 'Main-Class': 'com.mageddo.test.jmxhelloworld.bean.SimpleAgent'
//	}

//	println(sourceSets.main.resources.)

//	exclude "src/main/resources/**"

//	from files(sourceSets.main.output.classesDir){
//		println("x=" + Arrays.toString(sourceSets.main.output.classesDir.list()))


//		def iterable = sourceSets.main.output.resourcesDir;
//		ite
//		String[] files = new String[iterable.size()];
////		iterable.toList().toArray(new File[]);
//		int i=0;
//		iterable.each {
//			println("${it}")
//			files[i++] = it.absolutePath;
//		};
//
//		exclude files
//	}
//	from {
//		configurations.compile.collect {
//			it.isDirectory() ? it : fileTree(it)
//		}
//	}
//}

task tmp(type: Copy){
	doFirst{
		println("builded")
	}
	doLast{
		println("builded")
	}
}

build.doLast{

	println("the jar is ${ar.archivePath}")
	
	configurations.compile.collect {
			it.isDirectory() ? it : fileTree(it)
	}

	ant.jar(
			destfile: "updated-classes.jar",
			"keepcompression": "true"
	) {
		zipfileset("dir": sourceSets.main.output.classesDir)
	}

	ant.zip(destfile: "tmp.zip"){
		fileset("file": "updated-classes.jar")
		zipfileset("dir": sourceSets.main.output.resourcesDir)
		configurations.compile.collect {
			zipfileset("file": it.absolutePath, fullpath: "lib/${it.name}")
		}

	}
}

//jar  {
//	into "tmp-lib"
//	from configurations.compile
//	with jar
//
//}

//    repositories {
//        mavenCentral()
//        mavenLocal()
//        maven {
//            url uri("${rootProject.projectDir}/libs/maven")
//        }
//
//    }

dependencies {
	compile fileTree("${rootProject.projectDir}/lib/")
	compile fileTree("${rootProject.projectDir}/tools/")
	compile fileTree("${rootProject.projectDir}/plugins/")
}